name: Weekly Link Checker

on:
  schedule:
    - cron: '0 7 * * 1'  # Every Monday at 7 AM UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  check_links:
    runs-on: ubuntu-latest

    steps:
    - name: ⬇️ Checkout repo
      uses: actions/checkout@v4

    - name: 🐍 Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: 📦 Install dependencies
      run: pip install pandas openpyxl requests

    - name: 🔍 Run fast link checker with retry
      run: python check_links_enhanced.py

    - name: 📤 Commit results if output exists
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "github-actions@github.com"
        if ls broken_links.* 1> /dev/null 2>&1; then
          git add broken_links.*
          git commit -m "🔄 Update broken links report"
          git push
        else
          echo "✅ No broken links found — skipping commit."
        fi

    - name: 📁 Upload results as artifact
      uses: actions/upload-artifact@v4
      with:
        name: broken-links
        path: |
          broken_links.json
          broken_links.xlsx
